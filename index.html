<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <title>Поиск пропавших питомцев</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="mobile.css">
    <link rel="stylesheet" href="result-style.css">
    <link rel="icon" href="assets/favicon.png" type="image/x-icon">
    <link rel="shortcut icon" href="assets/favicon.png" type="image/x-icon">
    <script src="https://vk.com/js/api/xd_connection.js?2" type="text/javascript"></script>
    <script src="https://code.jquery.com/jquery-1.10.1.min.js"></script>

    <script type="text/javascript">
        VK.init(function () {
            /*document.getElementById('body').clientHeight*/
            VK.callMethod("resizeWindow", 650, 873);
            /* VK.callMethod("showSettingsBox", 8192);*/
            $(document).ready(function () {
                function scaleSize(maxW, maxH, currW, currH) {

                    var ratio = currH / currW;

                    if (currW >= maxW && ratio <= 1) {
                        currW = maxW;
                        currH = currW * ratio;
                    } else if (currH >= maxH) {
                        currH = maxH;
                        currW = currH / ratio;
                    }

                    return [currW, currH];
                }




                $('#mainForm').on('submit', (function (e) {
                    e.preventDefault();
                    var formData = new FormData(this);

                    $.ajax({
                        type: 'POST',
                        url: "https://vkhackathon.sevazhidkov.me/network/upload",
                        data: formData,
                        cache: false,
                        contentType: false,
                        processData: false,
                        success: function (data) {
                            console.log("success");
                            console.log(data);
                            var links = JSON.parse(data);
                            var urlLinks = [];
                            var urlPosts = [];
                            for (var i = 0; i < links["elems"].length; i++) {
                                urlLinks.push("https://api.rethumb.com/v1/square/280/" + links["elems"][i].url);
                                var post_id =  links["elems"][i].post_id;
                                var owner_id = links["elems"][i].owner_id;
                                urlPosts.push("https://vk.com/wall" + owner_id + "_" + post_id);
                            }
                            var i = 0;
                            $(".uploadPhoto").each(function(){
                                $(this).attr("src", urlLinks[i]);
                                i = i + 1;
                                console.log(i);
                            });
                            var i = 0;
                            $(".postLink").each(function(){
                                $(this).attr("href", urlPosts[i]);
                                i = i + 1;
                            });

                        },
                        error: function (data) {
                            console.log("error");
                            console.log(data);
                        }
                    });
                }));

                $("#ImageBrowse").on("change", function () {

                });

                $("#choosePhoto").click(function () {
                    console.log("sucess");
                    $("#ImageBrowse").click();
                });



                $("#startSearch").click(function () {
                    $("#mainForm").submit();
                    $("#page1").css("display", "none");

                    VK.callMethod("resizeWindow", 650, 2020);
                    $("#page2").css("display", "block");
                });



            });


        }, function () {
            // API initialization failed
            // Can reload page here
        }, '5.60');
    </script>

</head>

<body>
<div id="page1">
    <main class="container">

        <header class="container-header">
            <figure class="logo"></figure>
            <p class="header-text">
                <span class="header-text-l">Поиск пропавших котиков</span>
                <span class="header-text-s">По фотографии, при помощи технологии нейросетей</span>
            </p>
        </header>

        <section class="step-block step-block-1">

            <header class="header">
                <figure class="header-icon"></figure>
                <h2>Шаг 1. Выбор города</h2>
            </header>

            <figure class="picture"></figure>
            <p class="text">
                Мы поможем вам найти пропавшего домашнего любимца.<br><br>
                Для начала уточним город, в котором будем искать котика:
            </p>
            <p class="dropdown">Санкт-Петербург<span class="icon"></span></p>
            <span class="label">Определено автоматически</span>
        </section>

        <section class="step-block step-block-2">

            <header class="header">
                <figure class="header-icon"></figure>
                <h2>Шаг 2. Загрузка фотографии</h2>
            </header>
            <figure class="picture"></figure>
            <p class="text">
                Выберите самую качественную фотографию, на которой был запечатлён ваш котик.
                <br> Чем лучше фото – тем выше шанс найти именно вашего питомца.
            </p>
            <section class="attach-photo">
                <button id="choosePhoto" class="btn-big">Выбрать фотографию</button>
                <p class="url">или вы можете <a href="#">вставить URL-ссылку</a></p>
                <p class="photo-choosen">Вы выбрали файл: 6hsQGjj0.jpg</p>
            </section>
            
            <p class="url-field">Вставьте URL-ссылку<span class="url-cancel">Отменить</span></p>
        </section>
        
        <script>
            	$('.url-change').click(function(){
            		$('.attach-photo').css("display","none");
            		$('.url-field').css("display","inline-block");
            		return false;
            	});
            	$('.url-cancel').click(function(){
            		$('.url-field').css("display","none");
            		$('.attach-photo').css("display","block");
            		return false;
            	});
            </script>
        
        <section class="error">
			<figure class="icon"></figure>
			<span>Ошибка! Вы не выбрали фотографию</span>
		</section>

        <a href="#" id="startSearch" class="btn-search">
            <figure class="icon"></figure>
            Начать поиск</a>
    </main>

    <form style="display: none;" id="mainForm" enctype="multipart/form-data" style="padding: 20px;">
        <input name="file" type="file" id="ImageBrowse"/>
        <input type="submit" name="upload" value="Upload"/>
    </form>
</div>

<div id="page2" style="display: none;">
    <main class="container">

        <header class="container-header">
            <figure class="header-logo"></figure>
            <p class="header-text">
                <span class="header-text-l">Поиск пропавших котиков</span>
                <span class="header-text-s">По фотографии, при помощи технологии нейросетей</span>
            </p>
        </header>

        <button class="btn-medium btn-load-new">Загрузить другое фото</button>
        <span class="column-header">Вот, что нам удалось найти:</span>

        <section class="items">

            <article class="item">
                <figure class="photo">
                    <img class="uploadPhoto" src="">
                </figure>
                <span class="date">Размещено: 26 ноября 2016 в 20:51</span>
                <a class="postLink" href="#">Перейти к записи
                    <figure class="icon"></figure>
                </a>
            </article>

            <article class="item">
                <figure class="photo">
                    <img class="uploadPhoto" src="">
                </figure>
                <span class="date">Размещено: 26 ноября 2016 в 20:51</span>
                <a class="postLink" href="#">Перейти к записи
                    <figure class="icon"></figure>
                </a>
            </article>

            <article class="item">
                <figure class="photo">
                    <img class="uploadPhoto" src="">
                </figure>
                <span class="date">Размещено: 26 ноября 2016 в 20:51</span>
                <a class="postLink" href="#">Перейти к записи
                    <figure class="icon"></figure>
                </a>
            </article>

            <article class="item">
                <figure class="photo">
                    <img class="uploadPhoto" src="">
                </figure>
                <span class="date">Размещено: 26 ноября 2016 в 20:51</span>
                <a class="postLink" href="#">Перейти к записи
                    <figure class="icon"></figure>
                </a>
            </article>

            <article class="item">
                <figure class="photo">
                    <img class="uploadPhoto" src="">
                </figure>
                <span class="date">Размещено: 26 ноября 2016 в 20:51</span>
                <a class="postLink" href="#">Перейти к записи
                    <figure class="icon"></figure>
                </a>
            </article>

            <article class="item">
                <figure class="photo">
                    <img class="uploadPhoto" src="">
                </figure>
                <span class="date">Размещено: 26 ноября 2016 в 20:51</span>
                <a class="postLink" href="#">Перейти к записи
                    <figure class="icon"></figure>
                </a>
            </article>

            <article class="item">
                <figure class="photo">
                    <img class="uploadPhoto" src="">
                </figure>
                <span class="date">Размещено: 26 ноября 2016 в 20:51</span>
                <a class="postLink" href="#">Перейти к записи
                    <figure class="icon"></figure>
                </a>
            </article>

            <article class="item">
                <figure class="photo">
                    <img class="uploadPhoto" src="">
                </figure>
                <span class="date">Размещено: 26 ноября 2016 в 20:51</span>
                <a class="postLink" href="#">Перейти к записи
                    <figure class="icon"></figure>
                </a>
            </article>
        </section>

        <span class="column-header">Не нашли своего питомца? Давайте создадим пост:</span>

        <section class="post">
            <arctile class="field">
                <div class="textarea" contenteditable="true"></div>
                <div class="placeholder">Напишите о пропавшем котике...</div>
            </arctile>

            <button class="btn-medium suggest-post">Предложить пост</button>
            <figure class="pet-photo"></figure>
            <span class="text">Фотография, которую вы загрузили,<br>прикладывается к посту.</span>
        </section>
        <script type="text/javascript">
            $('.textarea').click(function () {
                $('.placeholder').hide();
                return false;
                $('.textarea').focus();
            });
            $('body').click(function () {
                $('.placeholder').show();
            });
        </script>
    </main>
</div>
</body>

</html>
